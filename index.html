<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ูููุฐุฌ ุทูุจ ููู ุงูุนูุด</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-10">
  <div class="max-w-2xl mx-auto bg-white p-6 rounded-xl shadow-lg">
    <h2 class="text-2xl font-bold mb-6 text-center text-blue-700">ูููุฐุฌ ุทูุจ ููู ุงูุนูุด</h2>

    <form id="moveForm" class="space-y-4">

      <!-- ุชูุงุตูู ููู ุงูุนูุด -->
      <label class="block">
        <span class="font-semibold">ุชูุงุตูู ููู ุงูุนูุด *</span>
        <textarea required name="details" class="w-full mt-1 p-2 border rounded-lg" rows="3" placeholder="ุงูุชุจ ุชูุงุตูู ููู ุงูุนูุด"></textarea>
      </label>

      <!-- ูุญุชููุงุช ููู ุงูุนูุด -->
      <label class="block">
        <span class="font-semibold">ูุญุชููุงุช ููู ุงูุนูุด *</span>
        <textarea required name="items" class="w-full mt-1 p-2 border rounded-lg" rows="3" placeholder="ุงูุชุจ ุงููุญุชููุงุช"></textarea>
      </label>

      <div class="grid grid-cols-2 gap-4">
        <!-- ููู ูู ุงูุฏูุฑ -->
        <label class="block">
          <span class="font-semibold">ููู ูู ุงูุฏูุฑ *</span>
          <input required type="number" name="from_floor" class="w-full mt-1 p-2 border rounded-lg" placeholder="ูุซุงู: 3" />
        </label>

        <!-- ุฅูู ุงูุฏูุฑ -->
        <label class="block">
          <span class="font-semibold">ุฅูู ุงูุฏูุฑ *</span>
          <input required type="number" name="to_floor" class="w-full mt-1 p-2 border rounded-lg" placeholder="ูุซุงู: 5" />
        </label>
      </div>

      <!-- ุงูุนููุงู ูู ูุฅูู -->
      <label class="block">
        <span class="font-semibold">ุงูุนููุงู ูู ูุฅูู *</span>
        <textarea required name="address" class="w-full mt-1 p-2 border rounded-lg" rows="2" placeholder="ุงูุชุจ ุงูุนููุงู ุจุงูุชูุตูู"></textarea>
      </label>

      <!-- ุฑูู ุงููุงุชุณุงุจ -->
      <label class="block">
        <span class="font-semibold">ุฑูู ุงููุงุชุณุงุจ (ูุชุฃููุฏ ุงูุทูุจ) *</span>
        <input required type="tel" name="whatsapp" id="whatsapp" class="w-full mt-1 p-2 border rounded-lg" placeholder="ูุซุงู: 2010XXXXXXXX (ุจุฏูู +)" />
      </label>

      <div class="grid grid-cols-3 gap-4 items-end">
        <!-- ููุฏ ุงูุชูุนูู -->
        <label class="block col-span-2">
          <span class="font-semibold">ููุฏ ุงูุชูุนูู (OTP) *</span>
          <input required type="text" name="otp" id="otp" class="w-full mt-1 p-2 border rounded-lg" placeholder="ุงูุชุจ ุงูููุฏ ุงููุฑุณู ุนูู ูุงุชุณุงุจ" />
        </label>

        <button type="button" id="sendOtpBtn" class="bg-green-600 text-white py-2 px-3 rounded-lg text-sm font-semibold hover:bg-green-700 transition-all">
          ุฅุฑุณุงู ุงูููุฏ
        </button>
      </div>

      <p id="otpMsg" class="text-center text-sm mt-1"></p>

      <!-- ููุงุญุธุงุช ุฅุถุงููุฉ -->
      <label class="block">
        <span class="font-semibold">ููุงุญุธุงุช ุฅุถุงููุฉ</span>
        <textarea name="notes" class="w-full mt-1 p-2 border rounded-lg" rows="2" placeholder="ุงูุชุจ ุฃู ููุงุญุธุงุช ุฅุถุงููุฉ"></textarea>
      </label>

      <!-- ุฒุฑ ุงุฑุณุงู ุงูุทูุจ -->
      <button type="submit"
              class="w-full bg-blue-600 text-white py-3 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-all">
        ุฅุฑุณุงู ุงูุทูุจ
      </button>
    </form>

    <p id="msg" class="text-center mt-4 font-semibold"></p>
  </div>

<script>
  const scriptURL = "https://script.google.com/macros/s/AKfycbxvWg_ff70-5wh7qLGC4sHrr3PSTqpgOql355DbpRIlPKyZeOAt1Lj5LRypohKGEkBB0A/exec";
  const form = document.getElementById("moveForm");
  const msg = document.getElementById("msg");
  const sendOtpBtn = document.getElementById("sendOtpBtn");
  const otpMsg = document.getElementById("otpMsg");

  // ุฅุฑุณุงู ููุฏ ุงูุชูุนูู
  sendOtpBtn.addEventListener("click", () => {
    const whatsapp = document.getElementById("whatsapp").value.trim();
    if (!whatsapp) {
      otpMsg.innerHTML = "ูู ูุถูู ุฃุฏุฎู ุฑูู ุงููุงุชุณุงุจ ุฃููุงู.";
      return;
    }

    otpMsg.innerHTML = "ุฌุงุฑู ุฅุฑุณุงู ุงูููุฏ...";
    const data = new FormData();
    data.append("action", "send_otp");
    data.append("whatsapp", whatsapp);

    fetch(scriptURL, { method: "POST", body: data })
      .then((res) => res.text())
      .then((text) => {
        console.log("send_otp response:", text);
        if (text.includes("OTP_SENT")) {
          otpMsg.innerHTML = "ุชู ุฅุฑุณุงู ุงูููุฏ ุฅูู ูุงุชุณุงุจุ ุจุฑุฌุงุก ุฅุฏุฎุงูู ูู ุงูุฎุงูุฉ ุฃุนูุงู.";
        } else {
          otpMsg.innerHTML = "ุฑุฏ ุงูุณูุฑูุฑ ุฃุซูุงุก ุฅุฑุณุงู ุงูููุฏ: " + text;
        }
      })
      .catch((err) => {
        console.error("send_otp error:", err);
        otpMsg.innerHTML = "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูููุฏุ ุญุงูู ูุฑุฉ ุฃุฎุฑู.";
      });
  });

  // ุฅุฑุณุงู ุงูุทูุจ ุจุนุฏ ุฅุฏุฎุงู OTP (ุจุงุณุชุฎุฏุงู no-cors)
  form.addEventListener("submit", (e) => {
    e.preventDefault();
    msg.innerHTML = "ุฌุงุฑู ุงูุฅุฑุณุงู...";

    const formData = new FormData(form);
    formData.append("action", "submit_order");

    fetch(scriptURL, {
      method: "POST",
      body: formData,
      mode: "no-cors"   // ๐ ููุง ุงูุณุญุฑ
    })
      .then(() => {
        // ูู ูุณุชุทูุน ูุฑุงุกุฉ ุงูุฑุฏุ ููู ูู ูููุด Network Error ูุนุชุจุฑู ูุงุฌุญ
        msg.innerHTML = "ุชู ุฅุฑุณุงู ุงูุทูุจุ ูุณูุชู ูุฑุงุฌุนุชู ุจุนุฏ ุชุฃููุฏ ุงูุจูุงูุงุช.";
        form.reset();
        otpMsg.innerHTML = "";
      })
      .catch((err) => {
        console.error("submit_order error:", err);
        msg.innerHTML = "ูุง ุฒุงู ููุงู ุฎุทุฃ ูู ุงูุงุชุตุงู: " + err;
      });
  });
</script>


</body>
</html>
